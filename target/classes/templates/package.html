<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Warehouse</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    body { background: #f5f7fa; font-family: 'Segoe UI', sans-serif; margin: 0; }
    .sidebar {
      background-color: #2c3e50; padding: 1rem 0.5rem; position: fixed; top: 0; left: 0;
      width: fit-content; height: 100vh; overflow-y: auto; z-index: 1000;
      display: flex; flex-direction: column; gap: 0.25rem;
    }
    .sidebar .nav-title {
      color: #bdc3c7; font-size: .85rem; text-transform: uppercase;
      padding: 0 1rem; white-space: nowrap;
    }
    .sidebar .nav-link {
      color: #ecf0f1; padding: 10px 16px; border-radius: 5px;
      display: flex; align-items: center; gap: 0.5rem; white-space: nowrap;
    }
    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      background-color: #34495e;
      border-left: 4px solid #6c75f0;
      color: #ffffff;
    }
    .sidebar .menu-text { display: inline; }
    .main-content {
      padding: 1.5rem;
      transition: margin-left 0.3s;
    }
    @media (max-width: 991.98px) {
      .sidebar {
        position: relative; width: 100%; height: auto;
        flex-direction: row; overflow-x: auto;
      }
      .main-content { margin-left: 0 !important; padding-top: 1rem; }
      .sidebar .nav-title { display: none; }
    }
    .stats-box .card {
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
    }
    .stats-box .card h5 { font-size: 1rem; color: #444; }
    .stats-box .card h4 { font-size: 1.4rem; font-weight: bold; }
    .table-container { overflow-x: auto; }
    table {
      width: 100%; border-collapse: separate; border-spacing: 0 1rem;
    }
    table thead {
      background: #6c75f0; color: white;
    }
    table thead th {
      cursor: pointer; text-align: left; padding: .75rem;
    }
    table tbody tr {
      background: #fff; border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: box-shadow .2s;
    }
    table tbody tr:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    table td {
      padding: .75rem; vertical-align: middle; background: #fff;
    }
    .status-label {
      display: inline-flex; align-items: center; gap: .3rem;
      padding: .3rem .8rem; border-radius: 999px;
      font-size: .85rem; font-weight: 500; text-transform: capitalize;
    }
    .status-imported { background: #fff3cd; color: #856404; }
    .status-on_shelf { background: #d3f9d8; color: #2b8a3e; }
    .status-exported { background: #d0ebff; color: #1c7ed6; }
    .filter-select { max-width: 200px; margin-bottom: 1rem; }
  </style>
</head>
<body>

<div id="sidebar-container"></div>

<div class="main-content">
  <div class="stats-box mb-4 d-flex flex-wrap gap-3">
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>Total Packages</h5><h4 id="stat-total">0</h4></div>
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>üì• IMPORTED</h5><h4 id="stat-imported">0</h4></div>
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>üì¶ ON SHELF</h5><h4 id="stat-onshelf">0</h4></div>
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>üöö EXPORTED</h5><h4 id="stat-exported">0</h4></div>
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>üå°Ô∏è Temp</h5><h4 id="stat-temp">-- ¬∞C</h4></div>
    <div class="card flex-fill text-center p-3 bg-light border-0"><h5>üíß Humidity</h5><h4 id="stat-humidity">-- %</h4></div>
  </div>

  <div class="card p-4 mb-4">
    <h2 class="text-center mb-4">üìã Package Form</h2>
    <form id="packageForm" class="row g-3">
      <input type="hidden" id="rfidInput"/>
      <div class="col-md-2"><input type="text" class="form-control" id="beaconNameInput" placeholder="Beacon Name" required/></div>
      <div class="col-md-2"><input type="text" class="form-control" id="zoneInput" placeholder="Zone" required/></div>
      <div class="col-md-2"><input type="text" class="form-control" id="blockInput" placeholder="Block" required/></div>
      <div class="col-md-3"><input type="datetime-local" class="form-control" id="timeInInput" required/></div>
      <div class="col-md-2"><input type="datetime-local" class="form-control" id="timeOutInput"/></div>
      <div class="col-md-1 d-grid"><button type="submit" class="btn btn-primary">üíæ</button></div>
    </form>
  </div>

  <select id="filterStatus" class="form-select filter-select mb-3">
    <option value="">All statuses</option>
    <option value="IMPORTED">IMPORTED</option>
    <option value="ON_SHELF">ON_SHELF</option>
    <option value="EXPORTED">EXPORTED</option>
  </select>

  <div class="table-container">
    <table class="table align-middle">
      <thead>
      <tr>
        <th data-sort="id">ID ‚áÖ</th>
        <th data-sort="poId">PO ID</th>
        <th data-sort="productId">Product ID</th>
        <th>RFID</th>
        <th>Beacon</th>
        <th>Zone</th>
        <th>Block</th>
        <th data-sort="time_in">Time In ‚áÖ</th>
        <th data-sort="time_out">Time Out ‚áÖ</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody id="packageTableBody"></tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="detailModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5>Package Details</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="detailBody"></div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
  </div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const apiBase = '/api/packages';
  let allData = [];
  let currentSort = { col: null, asc: true };

  async function initApp() {
    try {
      const [sb, pkgs] = await Promise.all([
        fetch('/sidebar').then(r => r.text()),
        fetch(apiBase).then(r => r.json())
      ]);

      document.getElementById('sidebar-container').innerHTML = sb;
      allData = pkgs;

      updateMainMargin();
      updateStats();
      renderTable(allData);
    } catch (err) {
      console.error('Load error:', err);
    }
  }

  function updateMainMargin() {
    const sb = document.querySelector('.sidebar');
    const main = document.querySelector('.main-content');
    if (window.innerWidth >= 992 && sb) {
      main.style.marginLeft = sb.offsetWidth + 'px';
    } else {
      main.style.marginLeft = '0';
    }
  }

  function updateStats() {
    document.getElementById('stat-total').textContent = allData.length;
    document.getElementById('stat-imported').textContent = allData.filter(p => p.status === 'IMPORTED').length;
    document.getElementById('stat-onshelf').textContent = allData.filter(p => p.status === 'ON_SHELF').length;
    document.getElementById('stat-exported').textContent = allData.filter(p => p.status === 'EXPORTED').length;
    document.getElementById('stat-temp').textContent = (20 + Math.random()*10).toFixed(1) + ' ¬∞C';
    document.getElementById('stat-humidity').textContent = (40 + Math.random()*30).toFixed(1) + ' %';
  }

  function renderTable(data) {
    const tb = document.getElementById('packageTableBody');
    tb.innerHTML = '';

    data.forEach(pkg => {
      const st = pkg.status || '';
      const cls = st.toLowerCase().replace(/\s/g, '_');
      const icon = st === 'IMPORTED' ? 'üì•' : st === 'ON_SHELF' ? 'üì¶' : st === 'EXPORTED' ? 'üöö' : '';
      const tr = document.createElement('tr');

      tr.innerHTML = `
          <td>${pkg.id||''}</td>
          <td>${pkg.poId||''}</td>
          <td>${pkg.productId||''}</td>
          <td>${pkg.rfid||''}</td>
          <td>${pkg.beacon_name||''}</td>
          <td>${pkg.zone||''}</td>
          <td>${pkg.block||''}</td>
          <td>${pkg.time_in||''}</td>
          <td>${pkg.time_out||''}</td>
          <td><span class="badge status-label status-${cls}">${icon} ${st}</span></td>
          <td>
            <button class="btn btn-info btn-sm me-1" onclick="showDetail('${pkg.id}')"><i class="bi bi-eye"></i></button>
            <button class="btn btn-warning btn-sm me-1" onclick="editPkg('${pkg.id}')"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-danger btn-sm" onclick="deletePkg('${pkg.id}')"><i class="bi bi-trash"></i></button>
          </td>
        `;
      tb.appendChild(tr);
    });
  }

  document.querySelector('#packageForm').addEventListener('submit', async e => {
    e.preventDefault();
    // B·∫°n c√≥ th·ªÉ th√™m logic submit t∆∞∆°ng t·ª± nh∆∞ ban ƒë·∫ßu...
  });

  window.addEventListener('DOMContentLoaded', initApp);
  window.addEventListener('resize', updateMainMargin);
</script>
</body>
</html>
